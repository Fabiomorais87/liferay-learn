# ページバージョニング

ページバージョニングを有効にすると、あなたとあなたのチームは、サイトのページとページセットの複数のバージョンで並行して作業できます。 これらの異なるバージョンは*バリエーション*と呼ばれ、ステージングバーを介してウィジェットページおよびコンテンツページ用に作成および管理できます。 ページバージョニングでは履歴も保持されており、必要に応じて、ステージングされたページに加えられた変更を以前のバージョンに戻すことができます。

```{note}
Liferay DXP 7.4、7.3フィックスパック1、および7.2フィックスパック11以降では、ウィジェットページとコンテンツページにバリエーションを作成できます。 以前のLiferay DXPバージョンでは、ウィジェットページでのみバリエーションを作成できました。 これらのタイプのページのバリエーションの詳細については、 [バリエーションの種類](#types-of-variatiバリエーションの種類ons) を参照してください。
```

プライベートページとパブリックページのページバージョニングは、最初のステージング設定時に有効にすることができ、その後も*［ステージング設定］*ページからいつでも有効にできます。 有効にすると、個々のページまたはページセットのバリエーションを作成、マージ、および公開できます。 さまざまなユーザーロールのバリエーション権限を管理することもできます。

- [ページバージョニング](#page-versioning)
- [バリエーションの種類](#types-of-variations)
- [バリエーションの作成](#creating-variations)
- [バリエーションのマージ](#merging-variations)
- [バリエーション権限の管理](#managing-variation-permissions)
- [追加情報](#additional-information)

## バリエーションの種類

ページセットの*ページバージョニング*を有効にすると、各ウィジェットページのステージングバーで2種類のバリエーションを作成および管理できます。

- **サイトページバリエーション**：サイトのページセットのバリエーションを使用して、複数のページを1つのセットとしてまとめながら変更できます。 ウィジェットページとコンテンツページでサイトページバリエーションを作成できます。

* **ページバリエーション**：ページセットバリエーション内に存在する単一ページバリエーション。 ウィジェットページでのみページバリエーションを作成できます。 コンテントページのさまざまなバージョンを作成するには、[エクスペリエンス](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md)を使用します。

   ```{tip}
   コンテンツページのページバリエーションは [コンテンツページのパーソナライゼーション](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md)を使用するので、ステージングツールを必要としません。 
   ```

ステージングサイトのすべてのバリエーションが同じコンテンツを共有するため、両方のバリエーションタイプはページにのみ影響し、サイトのコンテンツには影響しません。 しかし、各バリエーションでは、同じコンテンツやアプリケーションを異なる方法で使用・構成することができ、ページセットの各バリエーションでは、異なるページを持つことができます。

ただし、ページの*レイアウトタイプ*または*フレンドリURL*を変更すると、すべてのサイトページバリエーションに影響します。 たとえば、ページのテンプレートが変更された場合、それらの変更は、テンプレートから変更を継承するように設定されたページにプロパゲートされます。

```{note}
ページテンプレートは、ステージングフレームワークによって認識されません。 これは、既存のページテンプレートがステージングされたサイトで表示または編集できないことを意味します。 ステージングされたサイトで作成されたテンプレートは、ステージングが無効になっていると失われます。
```

## バリエーションの作成

次の手順に従って、ページまたはページセットの新しいバリエーションを作成します。

1. ステージングバーの*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックし、*［Site Pages Variation］*（ウィジェットページまたはコンテンツページの場合）または*［Page Variations］*（ウィジェットページの場合のみ）を選択します。

   ![ステージングバーのアクションボタンをクリックして、作成するバリエーションタイプを選択します。](./page-versioning/images/03.png)

1. モーダルウィンドウの右下にある*［Add］*ボタンをクリックします。

   ![モーダルウィンドウの右下にある [Add]ボタンをクリックします。](./page-versioning/images/04.png)

1. 新しいバリエーションの*名前*と*説明*を入力します。 これらのフィールドは、バリエーションに合わせていつでも変更できます。

   ![新しいバリエーションの名前と説明を入力します。](./page-versioning/images/05.png)

   ページセットバリエーションの場合、次のオプションから選択して、新しいページセットバリエーションが既存のバリエーションからページをコピーするかどうかを決定することもできます。

   * **すべてのサイトページバリエーション**：既存のすべてのページバリエーションを新しいページセットバリエーションにコピーします。

   * **なし（空のサイトページバリエーション）**：新しい空のページセットバリエーションを作成します。

   * **[Existing Variations]**：単一のページセットバリエーションからすべての既存のページバリエーションをコピーします。

   ![新しいページセットのバリエーションが既存のバリエーションからページをコピーするかどうかを決定します](./page-versioning/images/06.png)

   ```{note}
   既存のページバリエーションを新しいページセットバリエーションにコピーする場合は、公開の準備ができているとマークされた最新バージョンのみがコピーされます。
   ```

1. *［Add］*をクリックして新しいバリエーションを作成します。

作成したら、ステージングバーのドロップダウンメニューから、ページまたはページセットの各バージョンを切り替えることができます。 *［Page Variations］*ドロップダウンメニューは、ウィジェットページでのみ使用できます。 コンテンツページの場合は、[エクスペリエンス](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md)を使用してさまざまなバージョンを作成します。 詳細については、 [サイトステージングUIリファレンス](./site-staging-ui-reference.md) を参照してください。

![ステージングバーのドロップダウンメニューから、ページまたはページセットの各バージョンを切り替えることができます。](./page-versioning/images/02.png)

## バリエーションのマージ

2つのページセットバリエーションをマージできます。 マージにより、コンテンツに影響を与えたり上書きしたりすることなく、ページとページバリエーションがページセットのバリエーションに追加されます。

1. ステージング バーの*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックし、［Site Pages Variation］を選択します。

   ![［サイトページバリエーション］を選択します。](./page-versioning/images/07.png)

1. マージのベースとして使用するバリエーションの*アクション*ボタン（ ![Actions button](../../../images/icon-actions.png) ）をクリックし、*［Merge］*を選択します。

   ![マージのベースとして使用するバリエーションのアクションボタンをクリックし、［マージ］を選択します。](./page-versioning/images/08.png)

1. ベースとなるバリエーションの上にマージするバリエーションを選択します。

   ![ベースとなるバリエーションの上にマージするバリエーションを選択します。](./page-versioning/images/09.png)

サイトページの2つのバリエーションがマージされると、ベースとなるバリエーションに存在しない新しいページが追加されます。 また、ページが両方のバリエーションで存在し、ページの少なくとも1つのバージョンが公開の準備ができているとマークされている場合、準備ができているとマークされた最新バージョンが、ベースとなるバリエーションの対応するページの新しいバリエーションとして追加されます。 公開の準備ができているとマークされていない古いバリエーションはコピーされません。

## バリエーション権限の管理

各バリエーションに権限を設定して、特定のユーザーがすべてのバリエーションではなく一部のバリエーションを管理できるようにすることもできます。 詳細は、[ステージング権限の管理](./managing-staging-permissions.md)を参照してください。

## 追加情報

* [ステージングの概要](../staging.md)
* [ローカル現行環境ステージングの設定](./configuring-local-live-staging.md)
* [リモート本番環境ステージングの設定](./configuring-remote-live-staging.md)
* [サイトステージングUIリファレンス](./site-staging-ui-reference.md)
