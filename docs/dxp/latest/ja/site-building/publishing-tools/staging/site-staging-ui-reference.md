# サイトステージングUIリファレンス

サイトでローカルまたはリモートの本番環境ステージングを有効にすると、ほとんどのページ設定オプションはステージング環境でのみアクセス可能になります。 これにより、ユーザーは本番環境ページを直接編集できなくなります。

また、ステージングを有効にすると、ステージング環境で追加のオプションにアクセスできます。 これらのオプションは、*ステージング バー*、*[本番環境に公開]*メニュー、および*ステージングページ*にあります。

* [ステージング バー](#staging-bar)
* [本番環境に公開](#publish-to-live)
* [ステージングページ](#staging-page)

## ステージングバーと編集ツール

サイトのステージングが有効になっている場合、サイトの各ページのステージングバーから追加のオプションにアクセスできます。 このバーでは、ステージング環境と本番環境を切り替えたり、ステージングされたページの*[本番環境に公開]*をクリックしたりすることができます。

![サイトのステージングが有効になっている場合、サイトの各ページのステージングバーにアクセスできます。](./site-staging-ui-reference/images/02.png)

```{tip}
ステージングされたサイトでウィジェットページとコンテントページを操作する方法には違いがあります。 ステージングを使用してワークフローを簡素化するには、ウィジェットページまたはコンテントページのいずれかを使用します。
```

次の表と図は、ステージングバーのオプションと編集ツールについて説明しています。

| オプション           | ウィジェットページ                                       | コンテントページ                                                                                                                                                            | # |
|:--------------- |:----------------------------------------------- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:- |
| _サイトページバリエーション_ | <ul><li>ドロップダウンメニューを使用して、ステージングされたサイトのページセットのバリエーションを切り替えます。</li><li>ステージングバーの*アクション*ボタンをクリックし、*サイトページバリエーション*を選択して、ページセットのバリエーションを管理および作成します。 詳細については、 [ページバージョニング](./page-versioning.md) を参照してください。</li></ul>                       | ウィジェットページと同じ                                                                                                                                                        | 1 |
| _ページバリエーション_    | <ul><li>ドロップダウンメニューを使用して、ステージングされたサイトの単一ページのバリエーションを切り替えます。</li><li>ステージングバーの*アクション*ボタンをクリックし、*ページバリエーション*を選択して、ページバリエーションを管理および作成します。 詳細については、 [ページバージョニング](./page-versioning.md) を参照してください。</li></ul>                       | 利用不可。 コンテントページのさまざまなバージョンを作成するには、[エクスペリエンス](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md)を使用します。 | 2 |
| _元に戻す/やり直す_     | <ul><li>ステージングバーの*アクション*ボタンをクリックして、*Undo*/*やり直し*を選択します。</li><li>ページを*Ready for Publish Process*とマークした後は、最近の変更を元に戻したり、やり直したりすることはできません。</li></ul>                       | <ul><li>コンテントページエディタから、*Undo*または*やり直す*ボタンを使用してアクションを元に戻します。</li><li>ページの公開後は、最近の変更を元に戻したり、やり直したりすることはできません。</li></ul>                                                                                                                                           | 3 |
| _履歴_            | <ul><li>ステージングバーの*アクション*ボタンをクリックし、*履歴*を選択して、ページ改訂履歴を管理します。</li><li>復元するページバージョンの*アクション*ボタンをクリックし、*Mark as Ready for Publishing Process*を選択して、ページを以前のバージョンに戻します。</li></ul>                       | *［履歴］*ボタンを使用して、編集の前のバージョンに戻ります。                                                                                                                                     | 4 |
| _公開処理可能_        | <ul><li>*Ready for Publish Process*をクリックして、ページのステータスを*下書き*から*Ready for Publish Process*に変更します。</li><li>*本番環境に公開*をクリックして、変更の公開を構成および開始します。</li><li>ページを本番環境に公開すると、*Ready for Publish Process*とマークされたバージョンのみが公開されます。</li></ul>                       | <ul><li>利用不可。 コンテントページエディタの*公開*ボタンを使用します。</li><li>*本番環境に公開*をクリックして、変更の公開を構成および開始します。</li><li>ページを本番環境に公開すると、最後に公開されたバージョンが有効になります。</li></ul>                                                                                                                                           | 5 |
| コンテンツの編集        | Liferayアプリケーションバーの*［Add］*ボタンを使用して、ウィジェットを編集します。 | Liferayアプリケーションバーの*［編集］*ボタンを使用して、コンテントページエディタを開きます。                                                                                                                 | 6 |

- ウィジェットページのステージングバーと編集ツール：

   ![ウィジェットページを操作するステージングバーと編集ツール](./site-staging-ui-reference/images/18.png)

- コンテントページのステージングバーと編集ツール：

   ![コンテントページを操作するステージングバー](./site-staging-ui-reference/images/19.png)

   ![ウィジェットページを操作する編集ツール](./site-staging-ui-reference/images/20.png)

## 本番環境に公開

*[本番環境に公開]*をクリックすると、公開プロセスを設定するための追加オプションを含むモーダルウィンドウが表示されます。 *[Simple]*または*[詳細設定]*設定を使用して公開できます。

![ [本番環境に公開]をクリックして、公開モーダルウィンドウにアクセスします。](./site-staging-ui-reference/images/03.png)

## シンプルな公開

**Name**：公開プロセスのわかりやすい名前を*[Name]*フィールドに入力します。

**Changes Since Last Publish Process**：最後の公開プロセス以降に行われたステージングされた変更を表示します。

**公開するページ**：現在の公開プロセスに含まれるページ数を表示します。

```{note}
ステージングフレームワークによって追跡されたページの削除数が表示されます。 この数は、本番環境サイトで削除されるページ数ではなく、ステージングサイトでのページの削除数であることに注意してください。 公開されるページの削除数と、ステージングサイトと本番環境サイトのいずれかに存在する実際のページ数との間に不一致がある可能性があります。
```

準備ができたら、*[本番環境に公開]*をクリックして公開を開始します。

![ [本番環境に公開]をクリックして、公開を開始します。](./site-staging-ui-reference/images/04.png)

## 高度な公開

高度な公開を使用すると、公開プロセスをカスタマイズするために使用できる情報と設定にアクセスできます。 *[カスタム]*タブでは、コンテンツ、日付、ページなどを指定できます。 または、*[公開テンプレート]*タブをクリックして、公開プロセス用に事前設定されたテンプレートを選択します。 詳細設定にアクセスするには、モーダルウィンドウで*[Switch to Advanced Publish Process]*をクリックします。

![詳細設定を使用して、公開プロセスをカスタマイズします。](./site-staging-ui-reference/images/05.png)

カスタムの詳細設定は、次のセクションに分かれています。

**Name**：公開プロセスのわかりやすい名前を*[Name]*フィールドに入力します。

**日付**：変更をすぐに公開するか、 後で公開するように*スケジュール*するかを選択します。 また、公開プロセスを繰り返すかどうか、および繰り返す頻度を決定することもできます。

![変更をいつ公開するかを選択します。](./site-staging-ui-reference/images/06.png)

**Deletions**：*インポートする前にアプリケーションデータを削除する*かどうか、および*個々の削除を複製する*かどうかを選択します。

![インポートする前にアプリケーションデータを削除するかどうか、および個々の削除を複製するかどうかを選択します。](./site-staging-ui-reference/images/07.png)

**Pages**：公開するページセットのバリエーションと個々のページ、および選択したページのルックアンドフィールを選択します。 *行方不明ページを削除する*かどうかを選択することもできます。選択すると、ステージングサイトに存在しないすべてのページが本番環境サイトから削除されます。  [Pages]メニューから公開するページを選択すると、ウィジェットとその参照が常に公開されます。

![公開するページセットのバリエーションと個々のページ、および選択したページのルックアンドフィールを選択します。](./site-staging-ui-reference/images/08.png)

カスタムテーマを使用してページを公開する場合は、ステージング設定の*[ルック&フィール]見出しの下にある[テーマ設定]オプションをオンにする必要があります。 それ以外の場合は、デフォルトのテーマが適用されます。</p>

**コンテンツ**：公開プロセスに含めるコンテンツを選択します。 ラジオボタンを使用して、選択したタイプの*すべての*コンテンツを公開するか、日時のパラメーターを指定して公開されるコンテンツを制限できます。 このオプションを使用して、ステージングで変更され、公開待ちとなっているコンテンツを確認することもできます。

![公開プロセスに含めるコンテンツを選択します。](./site-staging-ui-reference/images/09.png)

| オプション     | 説明                            |
|:--------- |:----------------------------- |
| *すべて*     | 公開可能なすべてのコンテンツを表示します。         |
| *最新公開日から* | 前回の公開以降に更新されたコンテンツのみが表示されます。  |
| *日付の範囲*   | 特定の期間に更新されたコンテンツを表示します。       |
| *最後*      | 過去数時間または数日間に更新されたコンテンツを表示します。 |

```{note}
［コンテンツ］オプションを選択したら、*カウントを更新*をクリックして結果の数を更新します。
```

また、コンテンツタイプごとに*［Change］*をクリックして、*バージョン履歴*、*ボキャブラリ*、*プレビューとサムネイル表示*など、各タイプに含まれるアイテムやその他の設定を管理することもできます。 詳細は、[ステージングでのデータとコンテンツタイプの管理](./managing-data-and-content-types-in-staging.md)を参照してください。

```{important}
デフォルトでは、動的データリスト(DDL)表示、フォーム、Webコンテンツの表示、およびWiki表示のウィジェットを使用して表示されるコンテンツは、公開プロセスに常に含まれています。 Liferay DXP/Portal 7.4以降では、この動作を無効にして、表示されるコンテンツが公開プロセスの構成に明示的に含まれている場合にのみ公開されるようにすることができます。 詳細については、 [表示されたコンテンツの自動公開の設定](./configuring-automatic-publishing-of-displayed-content.md) を参照してください。
```

**権限設定**：変更が公開されたときにページとウィジェットの権限を含めるかどうかを選択します。

![変更が公開されたときにページとウィジェットの権限を含めるかどうかを選択します。](./site-staging-ui-reference/images/10.png)

ページまたはコンテンツを公開するたびに詳細オプションを手動で設定する代わりに、ステージング設定を [*公開テンプレート*](#publish-templates) として保存して、今後も使用できるようにすることができます。 公開プロセス用に保存されたテンプレートを表示および選択するには、*［公開テンプレート］*タブをクリックします。

![公開プロセス用に保存されたテンプレートを表示および選択するには、［公開テンプレート］タブをクリックします。](./site-staging-ui-reference/images/11.png)

準備ができたら、*［本番環境に公開］*をクリックして公開を開始します。

## ステージングページ

ステージングを有効にすると、*［公開設定］*タブから使用できるオプションが変更されます。 本番環境では、*エクスポート*機能にのみアクセスできます。 ステージング環境では、*インポート*および*ステージング*機能にのみアクセスできます。

ステージングページの新しいオプション（公開*プロセス*の表示、*公開テンプレート*の作成と管理、サイトのステージングの変更または無効化）にアクセスすることもできます。

![ステージングページで新しいオプションにアクセスすることもできます。](./site-staging-ui-reference/images/13.png)

### 以前および将来の公開プロセス

ステージングを使用して公開すると、*プロセス*としてキャプチャされ、後で参照できるように保存されます。 これらのプロセスを表示および管理するには、*［サイトメニュー］* &rarr; *［公開設定］* &rarr; *［ステージング］*に移動します。

*［Processes］*タブには、完了したステージングプロセスのリストがあります。 ここから、プロセスの*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックして、以前のパブリケーションの*概要*を*再開*、*クリア*、または表示できます。

![ステージングページから以前の公開プロセスを表示および管理します。](./site-staging-ui-reference/images/14.png)

*追加* （![Add button](../../../images/icon-add.png)）ボタンをクリックして、カスタム設定または事前定義された公開テンプレートを使用して新しい公開プロセスを作成することもできます。

*［予定済み］*タブでは、すべての予定済みの公開プロセスを表示できます。

### 公開テンプレート

同様のステージング設定を定期的に作成する場合は、独自の*公開テンプレート*を作成して時間を節約できます。 テンプレートを作成するには、*ステージング*ページの*アプリケーション*バーで*アクション*ボタン（ ![Actions button](../../../images/icon-actions.png) ）をクリックします。 次に、*［公開テンプレート］*を選択します。

![ステージングページのアプリケーションバーにあるアクションボタンをクリックします。](./site-staging-ui-reference/images/15.png)

ここから、頻繁に公開する設定のテンプレートを作成および管理できます。 次に、*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックして*［公開］*を選択すると、テンプレートを使用できます。

![頻繁に公開する設定のテンプレートを作成および管理します。](./site-staging-ui-reference/images/16.png)

ステージングバーの*［本番環境に公開］*ボタンを使用してページまたはコンテンツを公開するときにテンプレートを使用することもできます。 詳細は、 [Advanced Publishing](#advanced-publishing) を参照してください。

### ステージング設定

ステージングを設定した後、*ステージング*ページの*アプリケーション*バーにある*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックすると、ステージング設定ページにアクセスできます。  次に、*［ステージング設定］*を選択します。

![ステージングページのアプリケーションバーにあるアクションボタンをクリックして、ステージング設定にアクセスします。](./site-staging-ui-reference/images/17.png)

ここから、サイトのステージングを無効にしたり、[［ページバージョニング］](page-versioning.md)設定を変更したりできます。 ただし、*［ステージコンテンツ］*オプションは、初期設定後に変更することはできません。

## 追加情報

* [ステージングの概要](../staging.md)
* [公開プロセスを理解する](./understanding-the-publishing-process.md)
* [ページバージョニング](./page-versioning.md)
* [ステージングでのデータとコンテンツタイプの管理](./managing-data-and-content-types-in-staging.md)
